# èµ„æ·±æ¶æ„å¸ˆè§†è§’ï¼šæ¶æ„ç»ˆå®¡

> **Created**: 2025-12-19  
> **Reviewer**: AI (Senior Architect Perspective)  
> **Goal**: ä¸€æ¬¡é‡æ„åä¸å†éœ€è¦å¤§å‹é‡æ„

---

## ğŸ¯ è¯„å®¡ç›®æ ‡

1. ç¡®ä¿æ¶æ„æœ‰ **3-5 å¹´çš„æ‰©å±•èƒ½åŠ›**
2. è¯†åˆ« **æŠ€æœ¯å€ºåŠ¡** å’Œ **ä¾èµ–é£é™©**
3. éªŒè¯ **æ‰©å±•ç‚¹** æ˜¯å¦è¶³å¤Ÿçµæ´»
4. ç¡®ä¿ **ä¸ä¼šå†éœ€è¦å¤§å‹é‡æ„**

---

## ğŸ“Š å½“å‰çŠ¶æ€åˆ†æ

### ä»£ç è§„æ¨¡

| æ¨¡å— | è¡Œæ•° | å¤æ‚åº¦ | å¥åº·åº¦ |
|------|------|--------|--------|
| `sync/engine.rs` | 1601 | ğŸ”´ é«˜ | âš ï¸ éœ€è¦æ‹†åˆ† |
| `security.rs` | 1155 | ğŸ”´ é«˜ | âš ï¸ éœ€è¦æ‹†åˆ† |
| `config.rs` | 794 | ğŸŸ¡ ä¸­ | âš ï¸ éœ€è¦æ‹†åˆ† |
| `sync/plan.rs` | 581 | ğŸŸ¡ ä¸­ | âœ… å¯æ¥å— |
| `sync/orphan.rs` | 462 | ğŸŸ¢ ä½ | âœ… è‰¯å¥½ |
| `sync/lockfile.rs` | 388 | ğŸŸ¢ ä½ | âœ… è‰¯å¥½ |
| **æ€»è®¡** | ~21K | - | - |

### ä¾èµ–åˆ†æ

```
calvin v0.2.0
â”œâ”€â”€ anyhow v1.0.100        âœ… ç¨³å®šï¼Œæ— éœ€æ›¿æ¢
â”œâ”€â”€ atty v0.2.14           âš ï¸ å·²å½’æ¡£ï¼Œå»ºè®®è¿ç§»åˆ° is-terminal
â”œâ”€â”€ clap v4.5.53           âœ… ç¨³å®š
â”œâ”€â”€ crossterm v0.28.1      âœ… ç¨³å®š
â”œâ”€â”€ ctrlc v3.5.1           âœ… ç¨³å®š
â”œâ”€â”€ dialoguer v0.11.0      âœ… ç¨³å®š
â”œâ”€â”€ dirs v6.0.0            âœ… ç¨³å®š
â”œâ”€â”€ notify v8.2.0          âœ… ç¨³å®š
â”œâ”€â”€ serde v1.0.228         âœ… ç¨³å®š
â”œâ”€â”€ serde_ignored v0.1.14  âš ï¸ ä½ç»´æŠ¤ï¼Œä½†åŠŸèƒ½ç®€å•
â”œâ”€â”€ serde_yaml v0.9.34     âš ï¸ å·²å¼ƒç”¨ï¼Œå»ºè®®è¿ç§»
â”œâ”€â”€ sha2 v0.10.9           âœ… ç¨³å®š
â”œâ”€â”€ similar v2.7.0         âœ… ç¨³å®š
â”œâ”€â”€ tempfile v3.23.0       âœ… ç¨³å®š
â”œâ”€â”€ thiserror v2.0.17      âœ… ç¨³å®š
â”œâ”€â”€ toml v0.8.23           âœ… ç¨³å®š
â””â”€â”€ unicode-width v0.2.2   âœ… ç¨³å®š
```

**é£é™©ä¾èµ–**ï¼š
1. `atty` - å»ºè®®è¿ç§»åˆ° `is-terminal`ï¼ˆstd è®¡åˆ’å†…ç½®ï¼‰
2. `serde_yaml` - æ ‡è®°ä¸º deprecatedï¼Œå»ºè®®è¿ç§»åˆ° `serde_yml` æˆ–å…¶ä»–

---

## ğŸ” æ¶æ„æ·±åº¦å®¡æŸ¥

### 1. æ ¸å¿ƒé¢†åŸŸæ¨¡å‹ (Domain Model)

**å½“å‰é—®é¢˜**ï¼š
- æ²¡æœ‰æ˜ç¡®çš„ Domain Model
- `Asset` åˆ†æ•£åœ¨ parser + models
- `OutputFile` æ˜¯ä¸€ä¸ªç®€å•ç»“æ„ä½“ï¼Œç¼ºå°‘è¡Œä¸º

**å»ºè®®çš„ Domain Model**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DOMAIN MODEL                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    compiles to    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Asset     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  OutputFile  â”‚        â”‚
â”‚  â”‚             â”‚                   â”‚              â”‚        â”‚
â”‚  â”‚ - path      â”‚                   â”‚ - path       â”‚        â”‚
â”‚  â”‚ - content   â”‚                   â”‚ - content    â”‚        â”‚
â”‚  â”‚ - scope     â”‚                   â”‚ - target     â”‚        â”‚
â”‚  â”‚ - target    â”‚                   â”‚ - hash       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                                 â”‚                 â”‚
â”‚         â”‚                                 â”‚                 â”‚
â”‚         â–¼                                 â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Lockfile   â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  SyncPlan    â”‚        â”‚
â”‚  â”‚             â”‚    updates        â”‚              â”‚        â”‚
â”‚  â”‚ - entries   â”‚                   â”‚ - to_write   â”‚        â”‚
â”‚  â”‚ - scopes    â”‚                   â”‚ - to_skip    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ - conflicts  â”‚        â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Scope     â”‚                   â”‚   Target     â”‚        â”‚
â”‚  â”‚             â”‚                   â”‚              â”‚        â”‚
â”‚  â”‚ - User      â”‚                   â”‚ - ClaudeCode â”‚        â”‚
â”‚  â”‚ - Project   â”‚                   â”‚ - Cursor     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ - VSCode     â”‚        â”‚
â”‚                                    â”‚ - Antigravityâ”‚        â”‚
â”‚                                    â”‚ - Codex      â”‚        â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»“è®º**ï¼šâœ… é¢†åŸŸæ¨¡å‹æ¸…æ™°ï¼Œä½†éœ€è¦ä»£ç é‡ç»„æ¥æ˜ç¡®è¡¨è¾¾

### 2. æ‰©å±•ç‚¹åˆ†æ

**å½“å‰æ‰©å±•ç‚¹**ï¼š

| æ‰©å±•åœºæ™¯ | å½“å‰å®ç° | éš¾åº¦ | æ”¹è¿›å»ºè®® |
|----------|----------|------|----------|
| æ–°å¢ Target | æ·»åŠ  adapter æ–‡ä»¶ | ğŸŸ¡ ä¸­ | åº”è¯¥è‡ªåŠ¨æ³¨å†Œ |
| æ–°å¢ Scope | ä¿®æ”¹ enum | ğŸ”´ å›°éš¾ | éœ€è¦æ›´çµæ´»çš„æ¨¡å‹ |
| æ–°å¢ FileSystem | å®ç° trait | ğŸŸ¢ ç®€å• | å·²ç»å¾ˆå¥½ |
| æ–°å¢é…ç½®é¡¹ | ä¿®æ”¹å¤šå¤„ | ğŸ”´ å›°éš¾ | éœ€è¦é…ç½®ä¸­å¿ƒ |
| æ–°å¢å‘½ä»¤ | æ·»åŠ  command æ–‡ä»¶ | ğŸŸ¡ ä¸­ | åº”è¯¥è§£è€¦ |

**æœªæ¥å¯èƒ½çš„æ‰©å±•**ï¼š

| åœºæ™¯ | æ¦‚ç‡ | å½“å‰æ”¯æŒåº¦ |
|------|------|------------|
| æ–°çš„ AI å·¥å…· Target | ğŸ”´ é«˜ | âœ… æ”¯æŒ |
| æ–°çš„åŒæ­¥ç­–ç•¥ (S3, Git) | ğŸŸ¡ ä¸­ | âš ï¸ éœ€è¦é‡æ„ |
| å¤šä»“åº“æ”¯æŒ | ğŸŸ¡ ä¸­ | âŒ ä¸æ”¯æŒ |
| å›¢é˜Ÿåä½œç‰¹æ€§ | ğŸŸ¢ ä½ | âŒ ä¸æ”¯æŒ |
| æ’ä»¶ç³»ç»Ÿ | ğŸŸ¢ ä½ | âŒ ä¸æ”¯æŒ |

### 3. ä¾èµ–æ³¨å…¥åˆ†æ

**å½“å‰çŠ¶æ€**ï¼š
- æœ‰äº›åœ°æ–¹ç”¨ trait (FileSystem)
- å¤§å¤šæ•°åœ°æ–¹ç¡¬ç¼–ç ä¾èµ–

**é—®é¢˜ä»£ç ç¤ºä¾‹**ï¼š

```rust
// ç¡¬ç¼–ç ä¾èµ–
let fs = LocalFileSystem;  // ä¸å¯æµ‹è¯•
```

**å»ºè®®**ï¼š
- æ‰€æœ‰ I/O æ“ä½œé€šè¿‡ trait
- ä» main.rs æ³¨å…¥ä¾èµ–
- ä¸éœ€è¦ DI æ¡†æ¶ï¼ŒRust çš„ç±»å‹ç³»ç»Ÿè¶³å¤Ÿ

### 4. é”™è¯¯å¤„ç†åˆ†æ

**å½“å‰çŠ¶æ€**ï¼š
- ä½¿ç”¨ `anyhow::Result` å’Œ `thiserror`
- æœ‰è‡ªå®šä¹‰ `CalvinError`

**é—®é¢˜**ï¼š
- é”™è¯¯ç±»å‹åˆ†æ•£
- æœ‰äº›åœ°æ–¹ç”¨ `anyhow`ï¼Œæœ‰äº›ç”¨ `CalvinError`

**å»ºè®®**ï¼š
- ç»Ÿä¸€ä½¿ç”¨ `CalvinError`
- åªåœ¨ main.rs è¾¹ç•Œç”¨ `anyhow`

---

## ğŸ—ï¸ æ¶æ„ç»ˆæè®¾è®¡

### ç›®æ ‡ï¼š3-5 å¹´ä¸éœ€è¦å¤§å‹é‡æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CALVIN v3                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Presentation Layer                                 â”‚   â”‚
â”‚  â”‚  - CLI (clap)                                       â”‚   â”‚
â”‚  â”‚  - Interactive (dialoguer)                          â”‚   â”‚
â”‚  â”‚  - Output (text/json)                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                              â”‚
â”‚                              â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Application Layer (Use Cases)                      â”‚   â”‚
â”‚  â”‚  - DeployUseCase                                    â”‚   â”‚
â”‚  â”‚  - CheckUseCase                                     â”‚   â”‚
â”‚  â”‚  - WatchUseCase                                     â”‚   â”‚
â”‚  â”‚  - DiffUseCase                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                              â”‚
â”‚                              â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Domain Layer (Pure Business Logic)                 â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  Entities:                                          â”‚   â”‚
â”‚  â”‚    - Asset (source file with metadata)              â”‚   â”‚
â”‚  â”‚    - OutputFile (compiled output)                   â”‚   â”‚
â”‚  â”‚    - Lockfile (state tracking)                      â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  Services:                                          â”‚   â”‚
â”‚  â”‚    - Compiler (asset â†’ output)                      â”‚   â”‚
â”‚  â”‚    - Planner (detect changes)                       â”‚   â”‚
â”‚  â”‚    - Differ (compute diff)                          â”‚   â”‚
â”‚  â”‚    - OrphanDetector (find orphans)                  â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  Policies:                                          â”‚   â”‚
â”‚  â”‚    - ScopePolicy                                    â”‚   â”‚
â”‚  â”‚    - SecurityPolicy                                 â”‚   â”‚
â”‚  â”‚    - ConflictPolicy                                 â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  Ports (interfaces):                                â”‚   â”‚
â”‚  â”‚    - AssetRepository                                â”‚   â”‚
â”‚  â”‚    - LockfileRepository                             â”‚   â”‚
â”‚  â”‚    - FileSystem                                     â”‚   â”‚
â”‚  â”‚    - TargetAdapter                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                              â”‚
â”‚                              â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Infrastructure Layer (I/O)                         â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  Repositories:                                      â”‚   â”‚
â”‚  â”‚    - FsAssetRepository                              â”‚   â”‚
â”‚  â”‚    - TomlLockfileRepository                         â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  FileSystems:                                       â”‚   â”‚
â”‚  â”‚    - LocalFileSystem                                â”‚   â”‚
â”‚  â”‚    - RemoteFileSystem (SSH)                         â”‚   â”‚
â”‚  â”‚    - (future: S3FileSystem, GitFileSystem)          â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  Adapters:                                          â”‚   â”‚
â”‚  â”‚    - ClaudeCodeAdapter                              â”‚   â”‚
â”‚  â”‚    - CursorAdapter                                  â”‚   â”‚
â”‚  â”‚    - VSCodeAdapter                                  â”‚   â”‚
â”‚  â”‚    - (easily add new adapters)                      â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  Config:                                            â”‚   â”‚
â”‚  â”‚    - TomlConfigLoader                               â”‚   â”‚
â”‚  â”‚    - ConfigValidator                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®è®¾è®¡å†³ç­–

#### 1. Domain å±‚ä¸ä¾èµ–ä»»ä½• I/O

```rust
// âœ… æ­£ç¡®ï¼šDomain åªå®šä¹‰æ¥å£
pub trait AssetRepository {
    fn load_all(&self, source: &Path) -> Result<Vec<Asset>>;
}

// âœ… æ­£ç¡®ï¼šDomain æœåŠ¡åªä¾èµ–æ¥å£
pub fn compile<A: TargetAdapter>(assets: &[Asset], adapter: &A) -> Vec<OutputFile>;
```

#### 2. Infrastructure å®ç° Domain æ¥å£

```rust
// âœ… æ­£ç¡®ï¼šInfrastructure å®ç° Domain æ¥å£
pub struct FsAssetRepository { ... }

impl AssetRepository for FsAssetRepository {
    fn load_all(&self, source: &Path) -> Result<Vec<Asset>> {
        // å®é™… I/O æ“ä½œ
    }
}
```

#### 3. Application ç¼–æ’ä¸€åˆ‡

```rust
// âœ… æ­£ç¡®ï¼šUse Case é€šè¿‡æ¥å£ä¾èµ–
pub struct DeployUseCase<AR, LR, FS, TA>
where
    AR: AssetRepository,
    LR: LockfileRepository,
    FS: FileSystem,
    TA: TargetAdapter,
{
    asset_repo: AR,
    lockfile_repo: LR,
    file_system: FS,
    adapters: Vec<TA>,
}
```

---

## ğŸ”§ ä¾èµ–åº“å»ºè®®

### éœ€è¦è¿ç§»

| å½“å‰ | å»ºè®® | åŸå›  |
|------|------|------|
| `atty` | `is-terminal` | atty å·²å½’æ¡£ |
| `serde_yaml` | `serde_yml` æˆ–ç§»é™¤ | å·²å¼ƒç”¨ |

### å¯é€‰æ·»åŠ 

| åº“ | ç”¨é€” | å»ºè®® |
|-----|------|------|
| `tracing` | æ—¥å¿—/è¿½è¸ª | ğŸŸ¡ å¯é€‰ï¼Œå½“å‰æ— éœ€ |
| `tokio` | å¼‚æ­¥ | âŒ ä¸éœ€è¦ï¼Œä¿æŒç®€å• |
| `async-trait` | å¼‚æ­¥ trait | âŒ ä¸éœ€è¦ |

### ä¿æŒç®€å•åŸåˆ™

**ä¸å»ºè®®æ·»åŠ **ï¼š
- DI æ¡†æ¶ (Rust ç±»å‹ç³»ç»Ÿè¶³å¤Ÿ)
- å¼‚æ­¥è¿è¡Œæ—¶ (rsync æ–¹æ¡ˆå·²ç»æœ€ä¼˜)
- è¿‡å¤šæŠ½è±¡å±‚

---

## ğŸ§  é«˜è§ï¼šæŠ€æœ¯å†³ç­–ä¸æƒè¡¡

### 1. å…³äº Rust çš„é€‰æ‹©

**ä¼˜åŠ¿**ï¼ˆä¿æŒï¼‰ï¼š
- é›¶æˆæœ¬æŠ½è±¡ï¼štrait ä¸å¢åŠ è¿è¡Œæ—¶å¼€é”€
- å†…å­˜å®‰å…¨ï¼šæ—  GCï¼Œé€‚åˆ CLI å·¥å…·
- å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿï¼šç¼–è¯‘æ—¶æ•è·å¤§éƒ¨åˆ†é”™è¯¯
- å•äºŒè¿›åˆ¶åˆ†å‘ï¼šæ— éœ€è¿è¡Œæ—¶ä¾èµ–

**æ½œåœ¨é—®é¢˜**ï¼ˆéœ€è¦æ„è¯†ï¼‰ï¼š
- ç¼–è¯‘æ—¶é—´ï¼šéšç€é¡¹ç›®å¢é•¿ä¼šå˜æ…¢
- å­¦ä¹ æ›²çº¿ï¼šæ–°è´¡çŒ®è€…é—¨æ§›è¾ƒé«˜

**å»ºè®®**ï¼š
- è€ƒè™‘æ·»åŠ  `cargo-nextest` åŠ é€Ÿæµ‹è¯•
- è€ƒè™‘ `sccache` åŠ é€Ÿç¼–è¯‘ï¼ˆCI ä¸­ï¼‰

### 2. å…³äºç°æœ‰æ¶æ„çš„æ™ºæ…§

**å½“å‰æ¶æ„å·²ç»åšå¯¹çš„äº‹æƒ…**ï¼š

1. **FileSystem trait æŠ½è±¡**
   - Local, Remote, Mock éƒ½å®ç°åŒä¸€æ¥å£
   - è¿™æ˜¯æ­£ç¡®çš„æŠ½è±¡è¾¹ç•Œ

2. **rsync ä¼˜åŒ–**
   - æ¯” async æ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆ
   - åˆ©ç”¨ç°æœ‰å·¥å…·è€Œä¸æ˜¯é‡æ–°å‘æ˜

3. **batch_check_files**
   - å•æ¬¡ SSH æ£€æŸ¥å¤šä¸ªæ–‡ä»¶
   - å‡å°‘è¿æ¥å¼€é”€

4. **Adapter æ¨¡å¼**
   - ä¸åŒ AI å·¥å…·æœ‰ä¸åŒè¾“å‡ºæ ¼å¼
   - é€šè¿‡ adapter ç»Ÿä¸€

**éœ€è¦ä¿ç•™å¹¶æ‰©å±•çš„æ¨¡å¼**ï¼š

```rust
// è¿™ä¸ªæ¨¡å¼å¾ˆå¥½ï¼Œåº”è¯¥æ‰©å±•åˆ°å…¶ä»–é¢†åŸŸ
pub trait FileSystem {
    fn read_to_string(&self, path: &Path) -> CalvinResult<String>;
    fn write_atomic(&self, path: &Path, content: &str) -> CalvinResult<()>;
    // ...
}
```

### 3. å…³äºæµ‹è¯•ç­–ç•¥çš„å»ºè®®

**å½“å‰**ï¼šä¸»è¦æ˜¯å•å…ƒæµ‹è¯• + ä¸€äº› insta å¿«ç…§æµ‹è¯•

**å»ºè®®æ·»åŠ **ï¼š

1. **E2E æµ‹è¯•**ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
   - ä½¿ç”¨ tempdir åˆ›å»ºä¸´æ—¶ .promptpack
   - å®é™…è¿è¡Œ `calvin deploy`
   - éªŒè¯è¾“å‡ºæ–‡ä»¶

2. **é›†æˆæµ‹è¯•**ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
   - SyncEngine + çœŸå®æ–‡ä»¶ç³»ç»Ÿ
   - ä½†ä½¿ç”¨éš”ç¦»çš„æµ‹è¯•ç›®å½•

3. **å±æ€§æµ‹è¯•**ï¼ˆä½ä¼˜å…ˆçº§ï¼Œå¯é€‰ï¼‰
   - ä½¿ç”¨ `proptest` æˆ– `quickcheck`
   - éªŒè¯ä¸å˜é‡ï¼ˆå¦‚ï¼šdeploy å lockfile ä¸æ–‡ä»¶ä¸€è‡´ï¼‰

### 4. å…³äºé”™è¯¯å¤„ç†çš„å»ºè®®

**å½“å‰**ï¼šæ··ç”¨ `anyhow::Result` å’Œ `CalvinError`

**å»ºè®®ç»Ÿä¸€**ï¼š

```rust
// åœ¨ Domain å±‚ï¼šä½¿ç”¨é¢†åŸŸç‰¹å®šé”™è¯¯
pub enum DomainError {
    AssetNotFound(PathBuf),
    InvalidFrontmatter(String),
    // ...
}

// åœ¨ Application å±‚ï¼šåŒ…è£…é¢†åŸŸé”™è¯¯
pub enum ApplicationError {
    Domain(DomainError),
    Infrastructure(InfraError),
}

// åœ¨ main.rsï¼šè½¬æ¢ä¸º anyhow ç”¨äºæœ€ç»ˆè¾“å‡º
fn main() -> anyhow::Result<()> {
    // ...
}
```

### 5. å…³äºé…ç½®ç®¡ç†çš„å»ºè®®

**å½“å‰é—®é¢˜**ï¼šé…ç½®åˆ†æ•£åœ¨å¤šå¤„

**å»ºè®®**ï¼š

```rust
// é›†ä¸­çš„é…ç½®ä¸­å¿ƒ
pub struct CalvinConfig {
    // ä» TOML åŠ è½½çš„é…ç½®
    pub file_config: TomlConfig,
    // ä» CLI è§£æçš„é…ç½®
    pub cli_config: CliConfig,
    // ä»ç¯å¢ƒå˜é‡åŠ è½½çš„é…ç½®
    pub env_config: EnvConfig,
}

impl CalvinConfig {
    // åˆå¹¶æ‰€æœ‰é…ç½®æºï¼ŒæŒ‰ä¼˜å…ˆçº§ï¼šCLI > Env > File > Default
    pub fn merge(file: TomlConfig, cli: CliConfig, env: EnvConfig) -> Self { ... }
}
```

### 6. å…³äºæ‰©å±•æ€§çš„æœ€ç»ˆå»ºè®®

**çŸ­æœŸï¼ˆv0.3.0ï¼‰**ï¼š
- ä¸åšå¤§æ”¹åŠ¨
- åªä¿®å¤ `atty` ä¾èµ–é—®é¢˜
- å¢åŠ æµ‹è¯•è¦†ç›–

**ä¸­æœŸï¼ˆv0.4.0-v0.6.0ï¼‰**ï¼š
- é€æ­¥æå– Domain å±‚
- ä¿æŒç°æœ‰ API å…¼å®¹

**é•¿æœŸæ„¿æ™¯**ï¼š
- æ”¯æŒå¤š .promptpack æº
- æ”¯æŒå¤šé¡¹ç›®æ‰¹é‡éƒ¨ç½²
- å¯èƒ½çš„æ’ä»¶ç³»ç»Ÿï¼ˆä½†ä¸è¦è¿‡æ—©è§„åˆ’ï¼‰

### 7. å…³äº"ä¸éœ€è¦å†åšå¤§é‡æ„"çš„ä¿è¯

**æ¶æ„ä¸å˜é‡ï¼ˆå¿…é¡»æ°¸è¿œä¿æŒï¼‰**ï¼š

1. `Domain` å±‚ä¸ä¾èµ– `std::fs` æˆ–ä»»ä½• I/O
2. æ‰€æœ‰ I/O é€šè¿‡ `trait` æŠ½è±¡
3. ä¾èµ–åªå‘å†…æµåŠ¨
4. æ¯ä¸ªæ¨¡å— < 500 è¡Œ

**æ‰©å±•ç‚¹ï¼ˆæœªæ¥å¯ä»¥å®‰å…¨æ·»åŠ ï¼‰**ï¼š

1. æ–°çš„ Target adapterï¼ˆåªéœ€å®ç° traitï¼‰
2. æ–°çš„ FileSystemï¼ˆå¦‚ S3ï¼‰
3. æ–°çš„é…ç½®æ ¼å¼ï¼ˆå¦‚ YAML â†’ JSONï¼‰
4. æ–°çš„å‘½ä»¤ï¼ˆéµå¾ªç°æœ‰æ¨¡å¼ï¼‰

**ä¸éœ€è¦é‡æ„å°±èƒ½æ·»åŠ **ï¼š

- âœ… æ”¯æŒ Windsurfï¼ˆæ–° adapterï¼‰
- âœ… æ”¯æŒ S3 éƒ¨ç½²ï¼ˆæ–° FileSystemï¼‰
- âœ… æ”¯æŒ YAML é…ç½®ï¼ˆæ–° ConfigLoaderï¼‰

**å¯èƒ½éœ€è¦å°é‡æ„çš„åœºæ™¯**ï¼š

- âš ï¸ å¤š .promptpack æºï¼ˆéœ€è¦æ‰©å±• Source æ¦‚å¿µï¼‰
- âš ï¸ æ’ä»¶ç³»ç»Ÿï¼ˆéœ€è¦å®šä¹‰æ’ä»¶æ¥å£ï¼‰

**éœ€è¦å¤§é‡æ„çš„åœºæ™¯ï¼ˆåº”è¯¥é¿å…ï¼‰**ï¼š

- âŒ å®Œå…¨é‡å†™ UIï¼ˆå½“å‰ UI æ¶æ„å·²ç»å¾ˆå¥½ï¼‰
- âŒ æ”¹å˜æ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼ˆAsset, OutputFileï¼‰

---

## âœ… é‡æ„åéªŒæ”¶æ ‡å‡†

### ä»£ç è´¨é‡

- [ ] æ²¡æœ‰è¶…è¿‡ 500 è¡Œçš„æ–‡ä»¶
- [ ] æ²¡æœ‰è¶…è¿‡ 50 è¡Œçš„å‡½æ•°
- [ ] æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€
- [ ] å¾ªç¯ä¾èµ–ä¸º 0

### æ¶æ„åˆè§„

- [ ] Domain å±‚æ—  I/O ä¾èµ–
- [ ] æ‰€æœ‰ I/O é€šè¿‡ trait æŠ½è±¡
- [ ] Use Cases å¯ä»¥ç‹¬ç«‹æµ‹è¯•
- [ ] æ·»åŠ æ–° Target åªéœ€ 1 ä¸ªæ–‡ä»¶

### æµ‹è¯•è¦†ç›–

- [ ] æ ¸å¿ƒæ¨¡å—è¦†ç›–ç‡ > 80%
- [ ] æœ‰ E2E æµ‹è¯•
- [ ] æœ‰é›†æˆæµ‹è¯•

### æ–‡æ¡£å®Œæ•´

- [ ] æ¯ä¸ªå…¬å…± API æœ‰æ–‡æ¡£
- [ ] æ¶æ„æ–‡æ¡£ä¸ä»£ç åŒæ­¥
- [ ] æœ‰è´¡çŒ®è€…æŒ‡å—

---

## ğŸ“ ç»“è®º

### é£é™©è¯„ä¼°

| é£é™© | çº§åˆ« | ç¼“è§£æªæ–½ |
|------|------|----------|
| å›å½’ bug | ğŸ”´ é«˜ | å…ˆå¢åŠ æµ‹è¯•è¦†ç›– |
| æ—¶é—´è¶…æ”¯ | ğŸŸ¡ ä¸­ | åˆ†é˜¶æ®µï¼Œæ¯é˜¶æ®µéªŒæ”¶ |
| åŠŸèƒ½ä¸¢å¤± | ğŸŸ¢ ä½ | E2E æµ‹è¯•è¦†ç›– |

### é‡æ„å€¼å¾—å—ï¼Ÿ

**æ˜¯çš„**ï¼Œå› ä¸ºï¼š
1. å½“å‰æ¶æ„å·²ç»å¼€å§‹é˜»ç¢å¼€å‘
2. é•¿æœŸç»´æŠ¤æ˜¯ç›®æ ‡
3. ä¸€æ¬¡æ€§æŠ•å…¥ï¼Œé•¿æœŸæ”¶ç›Š

### æ—¶é—´ä¼°ç®—ï¼ˆä¿®è®¢ç‰ˆï¼‰

| é˜¶æ®µ | ä¹è§‚ | ä¿å®ˆ |
|------|------|------|
| 0.5: æµ‹è¯•è¦†ç›– | 2 å¤© | 4 å¤© |
| 1: éª¨æ¶ | 1 å¤© | 2 å¤© |
| 2: Domain | 3 å¤© | 5 å¤© |
| 3: Infrastructure | 2 å¤© | 4 å¤© |
| 4: Application | 2 å¤© | 3 å¤© |
| 5: Presentation | 1 å¤© | 2 å¤© |
| **æ€»è®¡** | **11 å¤©** | **20 å¤©** |

**å»ºè®®**ï¼šæŒ‰ä¿å®ˆä¼°ç®—è§„åˆ’ï¼Œå®é™…å¯èƒ½åœ¨ä¸­é—´ã€‚

---

## ğŸ”¬ æ·±åº¦æ¨¡å—åˆ†æ

### SyncEngine (1601 è¡Œ) - æœ€ç´§æ€¥éœ€è¦æ‹†åˆ†

**å½“å‰èŒè´£ï¼ˆå¤ªå¤šï¼ï¼‰**ï¼š
1. æ„é€ å’Œé…ç½® (`new`, `new_with_fs`, `local`, `home`, `remote`)
2. è®¡åˆ’ç”Ÿæˆ (`plan`)
3. å†²çªè§£å†³
4. æ‰§è¡ŒåŒæ­¥ (`execute`, `execute_with_callback`)
5. Lockfile æ›´æ–°
6. è¿œç¨‹åŒæ­¥é€»è¾‘
7. Dry-run æ¨¡å¼
8. å›è°ƒå¤„ç†

**æ‹†åˆ†å»ºè®®**ï¼š

```
SyncEngine (1601 lines) â†’ åˆ†è§£ä¸º:
â”œâ”€â”€ domain/planner.rs        (~200 lines)  - è®¡åˆ’ç”Ÿæˆ
â”œâ”€â”€ domain/differ.rs         (~100 lines)  - å·®å¼‚è®¡ç®—  
â”œâ”€â”€ application/deployer.rs  (~300 lines)  - æ‰§è¡Œé€»è¾‘
â”œâ”€â”€ application/resolver.rs  (~150 lines)  - å†²çªè§£å†³
â””â”€â”€ infrastructure/remote.rs (~200 lines)  - è¿œç¨‹åŒæ­¥
```

### security.rs (1155 è¡Œ) - éœ€è¦æ‹†åˆ†

**å½“å‰èŒè´£**ï¼š
1. å®‰å…¨æ£€æŸ¥å®šä¹‰
2. Doctor æŠ¥å‘Šç”Ÿæˆ
3. å¤šç§å®‰å…¨è§„åˆ™
4. è¾“å‡ºæ ¼å¼åŒ–

**æ‹†åˆ†å»ºè®®**ï¼š

```
security.rs (1155 lines) â†’ åˆ†è§£ä¸º:
â”œâ”€â”€ domain/policies/
â”‚   â”œâ”€â”€ mod.rs              - Policy trait
â”‚   â”œâ”€â”€ permission.rs       - æƒé™æ£€æŸ¥
â”‚   â”œâ”€â”€ path_safety.rs      - è·¯å¾„å®‰å…¨
â”‚   â””â”€â”€ content_safety.rs   - å†…å®¹å®‰å…¨
â”œâ”€â”€ application/doctor.rs   - Doctor ç”¨ä¾‹
â””â”€â”€ ui/views/doctor.rs      - è¾“å‡ºæ ¼å¼åŒ–
```

### config.rs (794 è¡Œ) - éœ€è¦æ‹†åˆ†

**å½“å‰èŒè´£**ï¼š
1. é…ç½®å®šä¹‰
2. é…ç½®åŠ è½½
3. é…ç½®éªŒè¯
4. é»˜è®¤å€¼å¤„ç†

**æ‹†åˆ†å»ºè®®**ï¼š

```
config.rs (794 lines) â†’ åˆ†è§£ä¸º:
â”œâ”€â”€ domain/config/
â”‚   â”œâ”€â”€ mod.rs          - Config struct
â”‚   â””â”€â”€ defaults.rs     - é»˜è®¤å€¼
â”œâ”€â”€ infrastructure/config/
â”‚   â”œâ”€â”€ loader.rs       - åŠ è½½é€»è¾‘
â”‚   â””â”€â”€ validator.rs    - éªŒè¯é€»è¾‘
```

---

## ğŸ”Œ æŠ€æœ¯æ ˆæ·±åº¦è¯„ä¼°

### ä¾èµ–å¥åº·åº¦è¯„åˆ†

| ä¾èµ– | ç»´æŠ¤çŠ¶æ€ | æ›¿ä»£æ–¹æ¡ˆ | è¿ç§»ç´§è¿«åº¦ | è¡ŒåŠ¨ |
|------|----------|----------|------------|------|
| `atty` | ğŸ”´ å½’æ¡£ | `is-terminal` | é«˜ | v0.3.0 è¿ç§» |
| `serde_yaml` | ğŸŸ¡ å¼ƒç”¨ | `serde_yml` | ä¸­ | v0.4.0 è¿ç§» |
| `serde_ignored` | ğŸŸ¡ ä½æ´»è·ƒ | è‡ªå®ç° | ä½ | ç›‘æ§ |
| `dialoguer` | ğŸŸ¢ æ´»è·ƒ | - | - | ä¿æŒ |
| `clap` | ğŸŸ¢ æ´»è·ƒ | - | - | ä¿æŒ |
| `notify` | ğŸŸ¢ æ´»è·ƒ | - | - | ä¿æŒ |

### å…³äº async çš„å†³å®š

**å½“å‰å®ç°**ï¼šåŒæ­¥ + rsync æ‰¹é‡ä¼˜åŒ–

**å†å²èƒŒæ™¯**ï¼š
> "å½“åˆå¼•å…¥ async å°±æ˜¯å› ä¸º SSH ä¸€ä¸ªä¸€ä¸ªæ–‡ä»¶ä¼ è¾“å¤ªæ…¢"

**å½“å‰è§£å†³æ–¹æ¡ˆ**ï¼ˆä¼˜äº asyncï¼‰ï¼š

1. **rsync æ‰¹é‡ä¼ è¾“**ï¼ˆ`src/sync/remote.rs`ï¼‰
   - å°†æ‰€æœ‰æ–‡ä»¶å…ˆå†™å…¥ä¸´æ—¶ç›®å½•
   - ä¸€æ¬¡ rsync è°ƒç”¨æ‰¹é‡ä¼ è¾“
   - åˆ©ç”¨ rsync çš„å¢é‡åŒæ­¥ï¼Œåªä¼ è¾“å˜æ›´éƒ¨åˆ†
   - **~10x æ€§èƒ½æå‡**

2. **SSH æ‰¹é‡æ£€æŸ¥**ï¼ˆ`src/fs.rs:batch_check_files`ï¼‰
   - å•æ¬¡ SSH è°ƒç”¨æ£€æŸ¥å¤šä¸ªæ–‡ä»¶çš„å­˜åœ¨æ€§å’Œ hash
   - é¿å… N æ¬¡ SSH è¿æ¥å¼€é”€

**ä¸ºä»€ä¹ˆ rsync > async**ï¼š

| æ–¹æ¡ˆ | è¿æ¥æ•° | å¤æ‚åº¦ | å¢é‡åŒæ­¥ |
|------|--------|--------|----------|
| åŒæ­¥é€æ–‡ä»¶ | N | ä½ | âŒ |
| async å¹¶å‘ | M (â‰¤N) | é«˜ | âŒ |
| rsync æ‰¹é‡ | **1** | ä½ | **âœ…** |

**ç»“è®º**ï¼š**ä¿æŒå½“å‰æ–¹æ¡ˆ**
- rsync å·²ç»æ˜¯æœ€ä¼˜è§£
- async ä¼šå¢åŠ å¤æ‚åº¦ä½†ä¸ä¼šæ›´å¿«
- å¦‚æœéœ€è¦å¹¶è¡Œï¼ˆå¦‚å¤šé¡¹ç›®éƒ¨ç½²ï¼‰ï¼Œå¯ä»¥åœ¨**è¿›ç¨‹çº§åˆ«**å¹¶è¡Œ

**æœªæ¥åœºæ™¯**ï¼š

| åœºæ™¯ | å»ºè®®æ–¹æ¡ˆ |
|------|----------|
| å¤šé¡¹ç›®æ‰¹é‡éƒ¨ç½² | è¿›ç¨‹çº§å¹¶è¡Œ (`rayon` æˆ– shell ç®¡é“) |
| å¤§æ–‡ä»¶ä¼ è¾“ | ç»§ç»­ç”¨ rsync |
| éœ€è¦å›è°ƒè¿›åº¦ | ä¿æŒåŒæ­¥é€æ–‡ä»¶ + callback |

### å…³äº trait çš„è®¾è®¡åŸåˆ™

**å½“å‰é—®é¢˜**ï¼š
- æœ‰äº› trait å¤ªå¤§ï¼ˆå¦‚ `TargetAdapter`ï¼‰
- æœ‰äº›åœ°æ–¹æ²¡æœ‰ç”¨ traitï¼ˆç¡¬ç¼–ç ï¼‰

**å»ºè®®çš„ trait è®¾è®¡**ï¼š

```rust
// âœ… ç»†ç²’åº¦ï¼ŒèŒè´£å•ä¸€
pub trait AssetLoader {
    fn load(&self, path: &Path) -> Result<Vec<Asset>>;
}

pub trait LockfileStorage {
    fn read(&self, path: &Path) -> Result<Option<Lockfile>>;
    fn write(&self, path: &Path, lockfile: &Lockfile) -> Result<()>;
}

pub trait OutputWriter {
    fn write(&self, output: &OutputFile) -> Result<()>;
    fn delete(&self, path: &Path) -> Result<()>;
}

// âŒ é¿å…ï¼šå•ä¸€å·¨å‹ trait
pub trait SyncBackend {
    fn load_assets(...) -> ...;
    fn read_lockfile(...) -> ...;
    fn write_lockfile(...) -> ...;
    fn write_output(...) -> ...;
    fn delete_output(...) -> ...;
    // ... å¤ªå¤šèŒè´£
}
```

---

## ğŸ¯ æ‰©å±•æ€§è®¾è®¡ä¿è¯

### 1. æ–°å¢ Target çš„æ‰©å±•æµç¨‹

**å½“å‰ï¼ˆéœ€è¦æ”¹è¿›ï¼‰**ï¼š
1. åˆ›å»º `adapters/new_target.rs`
2. ä¿®æ”¹ `adapters/mod.rs` æ·»åŠ å¯¼å‡º
3. ä¿®æ”¹ `cli.rs` æ·»åŠ  CLI å‚æ•°
4. ä¿®æ”¹ `config.rs` æ·»åŠ é…ç½®é¡¹
5. ä¿®æ”¹å¤šä¸ª command æ–‡ä»¶

**æ”¹è¿›åï¼ˆåªéœ€ 1 æ­¥ï¼‰**ï¼š
1. åˆ›å»º `infrastructure/adapters/new_target.rs` å¹¶å®ç° `TargetAdapter` trait
2. å…¶ä»–ä¸€åˆ‡è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œ

**å®ç°æ–¹å¼**ï¼šä½¿ç”¨ `inventory` crate æˆ–æ‰‹åŠ¨æ³¨å†Œè¡¨

### 2. æ–°å¢åŒæ­¥åç«¯çš„æ‰©å±•æµç¨‹

**å½“å‰**ï¼šä¸æ”¯æŒï¼ˆåªæœ‰æœ¬åœ° + SSHï¼‰

**æ”¹è¿›å**ï¼š
1. åˆ›å»º `infrastructure/backends/s3.rs` å®ç° `FileSystem` trait
2. è‡ªåŠ¨å¯ç”¨

### 3. æ–°å¢å‘½ä»¤çš„æ‰©å±•æµç¨‹

**å½“å‰ï¼ˆå¯æ¥å—ï¼‰**ï¼š
1. åˆ›å»º `commands/new_cmd.rs`
2. ä¿®æ”¹ `cli.rs` æ·»åŠ  CLI å®šä¹‰
3. ä¿®æ”¹ `main.rs` æ·»åŠ  dispatch

**æ”¹è¿›åï¼ˆå¯é€‰ï¼‰**ï¼š
ä½¿ç”¨å®è‡ªåŠ¨æ³¨å†Œï¼Œä½†æ”¶ç›Šä¸å¤§ï¼Œä¿æŒç°çŠ¶å³å¯ã€‚

---

## ğŸ“ æ¶æ„åŸåˆ™æ€»ç»“

### SOLID åœ¨ Calvin ä¸­çš„åº”ç”¨

| åŸåˆ™ | å½“å‰çŠ¶æ€ | æ”¹è¿›ç›®æ ‡ |
|------|----------|----------|
| **S** å•ä¸€èŒè´£ | âš ï¸ SyncEngine è¿å | âœ… æ¯ä¸ªæ¨¡å— < 500 è¡Œ |
| **O** å¼€é—­åŸåˆ™ | âš ï¸ æ·»åŠ  Target éœ€æ”¹å¤šå¤„ | âœ… é€šè¿‡ trait æ‰©å±• |
| **L** é‡Œæ°æ›¿æ¢ | âœ… FileSystem trait | âœ… ä¿æŒ |
| **I** æ¥å£éš”ç¦» | âš ï¸ æœ‰äº› trait å¤ªå¤§ | âœ… ç»†ç²’åº¦ trait |
| **D** ä¾èµ–åè½¬ | âš ï¸ éƒ¨åˆ†ç¡¬ç¼–ç  | âœ… å…¨éƒ¨é€šè¿‡ trait |

### æ ¸å¿ƒæ¶æ„ä¸å˜é‡

è¿™äº›æ˜¯**æ°¸è¿œä¸åº”è¯¥è¿å**çš„è§„åˆ™ï¼š

1. **Domain å±‚é›¶ I/O ä¾èµ–**
   - Domain åªä¾èµ– std åº“
   - æ‰€æœ‰ I/O é€šè¿‡ trait æŠ½è±¡

2. **ä¾èµ–åªå‘å†…**
   - Presentation â†’ Application â†’ Domain â† Infrastructure
   - ç¦æ­¢åå‘ä¾èµ–

3. **æ¯ä¸ªæ¨¡å—æœ‰æ¸…æ™°è¾¹ç•Œ**
   - ä¸€ä¸ªæ¨¡å—åªåšä¸€ä»¶äº‹
   - é€šè¿‡å…¬å…± API é€šä¿¡

4. **æµ‹è¯•ä¸ä¾èµ–çœŸå®æ–‡ä»¶ç³»ç»Ÿ**
   - æ‰€æœ‰æ–‡ä»¶æ“ä½œé€šè¿‡ `FileSystem` trait
   - æµ‹è¯•ä½¿ç”¨ `MockFileSystem`

---

## ğŸš€ ç«‹å³è¡ŒåŠ¨é¡¹

### é«˜ä¼˜å…ˆçº§ï¼ˆv0.3.0ï¼‰

1. [ ] **è¿ç§» `atty` â†’ `is-terminal`**ï¼ˆ1 å°æ—¶ï¼‰
2. [ ] **å¢åŠ  SyncEngine æµ‹è¯•è¦†ç›–**ï¼ˆ4 å°æ—¶ï¼‰
3. [ ] **æå– Planner åˆ°ç‹¬ç«‹æ¨¡å—**ï¼ˆ2 å°æ—¶ï¼‰

### ä¸­ä¼˜å…ˆçº§ï¼ˆv0.4.0ï¼‰

1. [ ] **å®Œæˆ Domain å±‚æå–**
2. [ ] **è¿ç§» `serde_yaml` â†’ `serde_yml`**
3. [ ] **ç»Ÿä¸€é”™è¯¯å¤„ç†**

### ä½ä¼˜å…ˆçº§ï¼ˆv0.5.0+ï¼‰

1. [ ] **æ”¯æŒå¤š Target æ‰¹é‡éƒ¨ç½²**
2. [ ] **è€ƒè™‘æ’ä»¶ç³»ç»Ÿ**
3. [ ] **æ€§èƒ½ä¼˜åŒ–ï¼ˆå¤§è§„æ¨¡ PromptPackï¼‰**

