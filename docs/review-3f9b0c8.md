# Commit 3f9b0c83 å®ç°å®¡æŸ¥æŠ¥å‘Š

> **å®¡æŸ¥æ—¥æœŸ**: 2025-12-17  
> **å®¡æŸ¥äºº**: AI Code Reviewer  
> **Commit**: `3f9b0c83638fce9884b61f65465260157c9aaab4`  
> **æ ‡é¢˜**: `feat: implement core Calvin phases (1-5, 7) with TDD`

---

## æ¦‚è¿°

æœ¬ commit å®ç°äº† Calvin é¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ Phase 1-5 å’Œ Phase 7 çš„å…³é”®ç‰¹æ€§ã€‚æ•´ä½“å®ç°è´¨é‡è¾ƒé«˜ï¼Œéµå¾ªäº† TDD æ–¹æ³•è®ºï¼Œå…±è®¡ 113 ä¸ªæµ‹è¯•ç”¨ä¾‹é€šè¿‡ã€‚æœ¬æŠ¥å‘Šå°†ä»**æ–‡æ¡£å¯¹é½åº¦**å’Œ**éšå«é—®é¢˜**ä¸¤ä¸ªç»´åº¦è¿›è¡Œä¸“ä¸šå®¡æŸ¥ã€‚

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæ–‡æ¡£å¯¹é½åº¦å®¡æŸ¥

### 1.1 ä¸ spec.md çš„å¯¹é½æƒ…å†µ

| éœ€æ±‚ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| æºæ ¼å¼ PromptPack ç›®å½•ç»“æ„ | âœ… å¯¹é½ | ä½¿ç”¨ `.promptpack/` ä½œä¸ºæºç›®å½• |
| YAML frontmatter è§£æ | âœ… å¯¹é½ | å®ç°äº† `---` åˆ†éš”ç¬¦è§£æ |
| å¿…éœ€å­—æ®µ `description` | âœ… å¯¹é½ | ç¼ºå¤±æ—¶æŠ¥é”™ |
| å¯é€‰å­—æ®µ (kind/scope/targets/apply) | âœ… å¯¹é½ | å‡æœ‰åˆç†é»˜è®¤å€¼ |

#### Claude Code é€‚é…å™¨

| éœ€æ±‚ (spec.md 4.1) | å¯¹é½çŠ¶æ€ | è¯´æ˜ |
|-------------------|---------|------|
| `.claude/commands/<id>.md` | âœ… å¯¹é½ | æ­£ç¡®ç”Ÿæˆ |
| `$ARGUMENTS` æ”¯æŒ | âš ï¸ éƒ¨åˆ† | æ–‡æ¡£æåˆ°ä½†ä»£ç æœªåœ¨å‘½ä»¤ä¸­è‡ªåŠ¨æ’å…¥ |
| `.claude/settings.json` | âœ… å¯¹é½ | ç”Ÿæˆ security baseline |
| `permissions.deny` å¼ºåˆ¶ç”Ÿæˆ | âœ… å¯¹é½ | TD-16 ç¡¬ç¼–ç æœ€å° deny åˆ—è¡¨ |
| `.claude/settings.local.json` | âŒ ç¼ºå¤± | spec è¦æ±‚ä½†æœªå®ç° |
| `~/.claude/commands/` (ç”¨æˆ·çº§) | âŒ ç¼ºå¤± | Phase 6 å†…å®¹ï¼Œæœªåœ¨æœ¬ commit å®ç° |
| Agents (`~/.claude/agents/`) | âŒ ç¼ºå¤± | spec ä¸­æåˆ°ä½†æœªå®ç° |
| æ’ä»¶å¯¼å‡º (`export claude-plugin`) | âŒ ç¼ºå¤± | é«˜é˜¶åŠŸèƒ½æœªå®ç° |

#### Cursor é€‚é…å™¨

| éœ€æ±‚ (spec.md 4.2) | å¯¹é½çŠ¶æ€ | è¯´æ˜ |
|-------------------|---------|------|
| `.cursor/rules/<id>/RULE.md` | âœ… å¯¹é½ | åŒ…å« frontmatter |
| `description` / `globs` / `alwaysApply` | âœ… å¯¹é½ | æ­£ç¡®æ˜ å°„ |
| `.cursor/commands/<id>.md` | âœ… å¯¹é½ | action ç±»å‹æ­£ç¡®ç”Ÿæˆ |
| `.cursor/mcp.json` | âš ï¸ éƒ¨åˆ† | æ£€æµ‹å­˜åœ¨ä½†ä¸ç”Ÿæˆ allowlist |
| MCP ç™½åå•æœºåˆ¶ | âš ï¸ æœªå®ç° | spec å¼ºè°ƒä½†ä»£ç æœªå®ç° |

#### VS Code é€‚é…å™¨

| éœ€æ±‚ (spec.md 4.3) | å¯¹é½çŠ¶æ€ | è¯´æ˜ |
|-------------------|---------|------|
| `.github/copilot-instructions.md` (åˆå¹¶æ¨¡å¼) | âœ… å¯¹é½ | é»˜è®¤ç”Ÿæˆ |
| `.github/instructions/<id>.instructions.md` (æ‹†åˆ†æ¨¡å¼) | âœ… å¯¹é½ | æœ‰ apply æ—¶æ‹†åˆ† |
| `applyTo` frontmatter | âœ… å¯¹é½ | æ­£ç¡®æ˜ å°„ |
| `AGENTS.md` ç”Ÿæˆ | âœ… å¯¹é½ | æœ‰ `generate_agents_md` å‡½æ•° |
| `chat.useAgentsMdFile` è®¾ç½®æ£€æŸ¥ | âš ï¸ éƒ¨åˆ† | doctor ä¸­æœªæ£€æŸ¥æ­¤è®¾ç½® |

#### Antigravity é€‚é…å™¨

| éœ€æ±‚ (spec.md 4.4) | å¯¹é½çŠ¶æ€ | è¯´æ˜ |
|-------------------|---------|------|
| `.agent/rules/<id>.md` | âœ… å¯¹é½ | æ­£ç¡®ç”Ÿæˆ |
| `.agent/workflows/<id>.md` | âœ… å¯¹é½ | action ç±»å‹æ­£ç¡®ç”Ÿæˆ |
| å…¨å±€è§„åˆ™ `~/.gemini/` | âŒ ç¼ºå¤± | Phase 6 å†…å®¹ |
| Terminal mode (Turbo) è­¦å‘Š | âš ï¸ éƒ¨åˆ† | doctor ä¸­æœ‰è­¦å‘Šä½†æ— æ³•å®é™…æ£€æµ‹ |
| Browser allowlist | âŒ ç¼ºå¤± | `browserAllowlist.txt` æœªå¤„ç† |

#### Codex é€‚é…å™¨

| éœ€æ±‚ (spec.md 4.5) | å¯¹é½çŠ¶æ€ | è¯´æ˜ |
|-------------------|---------|------|
| `~/.codex/prompts/<id>.md` | âš ï¸ éƒ¨åˆ† | ç”Ÿæˆè·¯å¾„æ­£ç¡®ä½†ä½¿ç”¨ `~` å­—é¢é‡ |
| `$ARGUMENTS` å ä½ç¬¦ | âœ… å¯¹é½ | è‡ªåŠ¨æç¤ºä½¿ç”¨ |
| ç”¨æ³•æ–‡æ¡£å¤´ | âœ… å¯¹é½ | è‡ªåŠ¨ç”Ÿæˆ `/prompts:<id>` ç”¨æ³• |
| å‘½åå‚æ•° `$KEY` éªŒè¯ | âœ… å¯¹é½ | validate ä¸­æ£€æŸ¥æœªæ–‡æ¡£åŒ–çš„å ä½ç¬¦ |

### 1.2 ä¸ tech-decisions.md çš„å¯¹é½æƒ…å†µ

| Tech Decision | çŠ¶æ€ | è¯´æ˜ |
|--------------|------|------|
| TD-1: Rust | âœ… å¯¹é½ | å®Œå…¨ä½¿ç”¨ Rust å®ç° |
| TD-2: clap | âœ… å¯¹é½ | ä½¿ç”¨ derive å® |
| TD-3: serde_yaml | âœ… å¯¹é½ | è‡ªå®šä¹‰ frontmatter æå– + serde |
| TD-4: ä¸Šä¸‹æ–‡æ„ŸçŸ¥è½¬ä¹‰ | âœ… å¯¹é½ | `OutputFormat` æšä¸¾ + è½¬ä¹‰å‡½æ•° |
| TD-5: notify | âœ… å¯¹é½ | ç”¨äº watch å‘½ä»¤ï¼ˆwatcher.rsï¼‰|
| TD-6: è¿œç¨‹åŒæ­¥é™çº§ | âŒ ç¼ºå¤± | Windows scp é™çº§æœªå®ç° |
| TD-7: TOML é…ç½® | âœ… å¯¹é½ | config.rs å®Œæ•´å®ç° |
| TD-8: JSON è¾“å‡º | âœ… å¯¹é½ | `--json` å…¨å±€æ ‡å¿— |
| TD-9: æµ‹è¯•ç­–ç•¥ | âš ï¸ éƒ¨åˆ† | æœ‰å•å…ƒæµ‹è¯•ï¼Œç¼ºå°‘ snapshot/golden æµ‹è¯• |
| TD-10: é”™è¯¯å¤„ç† | âœ… å¯¹é½ | anyhow + thiserror |
| TD-11: äºŒè¿›åˆ¶åˆ†å‘ | âŒ ç¼ºå¤± | Phase 9 å†…å®¹ |
| TD-12: MCP ç™½åå• | âŒ ç¼ºå¤± | æœªå®ç°å†…ç½®ç™½åå•æœºåˆ¶ |
| TD-13: å®‰å…¨æ¨¡å¼ | âœ… å¯¹é½ | yolo/balanced/strict ä¸‰çº§ |
| TD-14: åŸå­å†™å…¥ | âœ… å¯¹é½ | tempfile + rename + é‡è¯• |
| TD-15: Lockfile | âœ… å¯¹é½ | `.promptpack/.calvin.lock` |
| TD-16: ç¡¬ç¼–ç æœ€å° deny | âœ… å¯¹é½ | MINIMUM_DENY å¸¸é‡ |
| TD-17: äºŒè¿›åˆ¶ä¼˜åŒ– | âŒ ç¼ºå¤± | Cargo.toml æœªé…ç½® release profile |
| TD-18: ç‰ˆæœ¬åŒ–é€‚é…å™¨ | âŒ ç¼ºå¤± | Trait ä¸­æ— ç‰ˆæœ¬æ–¹æ³• |

### 1.3 ä¸ pitfall-mitigations.md çš„å¯¹é½æƒ…å†µ

| Pitfall | ç¼“è§£çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|
| P1: ç›®æ ‡è„†å¼±æ€§ (IDE ç‰ˆæœ¬) | âŒ æœªå®ç° | æ— ç‰ˆæœ¬æ£€æµ‹/è­¦å‘Šæœºåˆ¶ |
| P2: è½¬ä¹‰åœ°ç‹± | âœ… å·²ç¼“è§£ | escaping.rs å®Œæ•´å®ç° |
| P3: æ–‡ä»¶é”å®š/Windows åŒæ­¥ | âš ï¸ éƒ¨åˆ† | åŸå­å†™å…¥æœ‰é‡è¯•ï¼Œè¿œç¨‹åŒæ­¥æœªå®ç° |
| P4: å¹‚ç­‰æ€§ vs ç”¨æˆ·ç¼–è¾‘ | âœ… å·²ç¼“è§£ | lockfile æ£€æµ‹ + SKIP è­¦å‘Š |
| P5: è·¯å¾„è§£æ | âš ï¸ æœªéªŒè¯ | ä»£ç ä¸­æœªè§è·¯å¾„å®‰å…¨æ£€æŸ¥ |
| P6: Yolo æ¨¡å¼é£é™© | âœ… å·²ç¼“è§£ | ç¡¬ç¼–ç æœ€å° deny åˆ—è¡¨ |
| P7: äºŒè¿›åˆ¶è†¨èƒ€ | âŒ æœªå¤„ç† | æœªé…ç½®ä¼˜åŒ– profile |

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šéšå«é—®é¢˜åˆ†æ

### 2.1 ä¸¥é‡é—®é¢˜ (Critical)

#### é—®é¢˜ 1ï¼šè·¯å¾„å®‰å…¨æ€§æ£€æŸ¥ç¼ºå¤±

**ä½ç½®**: `src/parser.rs`, `src/adapters/*.rs`

**æè¿°**: spec.md (P5) å’Œ pitfall-mitigations.md è¦æ±‚éªŒè¯è·¯å¾„ä¸èƒ½é€ƒå‡ºé¡¹ç›®è¾¹ç•Œï¼Œä½†ä»£ç ä¸­æœªè§ä»»ä½•ç›¸å…³æ£€æŸ¥ã€‚

```rust
// ç¼ºå¤±: ç±»ä¼¼è¿™æ ·çš„å®‰å…¨æ£€æŸ¥
fn resolve_path(reference: &str, project_root: &Path) -> Result<PathBuf> {
    let absolute = project_root.join(reference).canonicalize()?;
    if !absolute.starts_with(project_root) {
        return Err("Path escapes project boundary");
    }
    // ...
}
```

**é£é™©**: æ¶æ„æˆ–é”™è¯¯é…ç½®çš„ `.promptpack/` æ–‡ä»¶å¯èƒ½é€šè¿‡ `../../../etc/passwd` è¿™ç±»è·¯å¾„è¯»å–æ•æ„Ÿæ–‡ä»¶ã€‚

**å»ºè®®**: åœ¨ `parse_file` å’Œæ‰€æœ‰èµ„æºå¼•ç”¨å¤„æ·»åŠ è¾¹ç•Œæ£€æŸ¥ã€‚

---

#### é—®é¢˜ 2ï¼šCodex é€‚é…å™¨è·¯å¾„ä½¿ç”¨å­—é¢é‡ `~`

**ä½ç½®**: `src/adapters/codex.rs:78`

```rust
PathBuf::from("~/.codex/prompts")  // è¿™ä¸ä¼šå±•å¼€ ~
```

**æè¿°**: `PathBuf::from("~")` ä¸ä¼šè‡ªåŠ¨å±•å¼€ä¸ºç”¨æˆ·ä¸»ç›®å½•ã€‚sync æ—¶éœ€è¦æ˜¾å¼å¤„ç†ã€‚

**é£é™©**: è¾“å‡ºè·¯å¾„å¯èƒ½è¢«å†™å…¥å­—é¢é‡åä¸º `~` çš„ç›®å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œè€Œéç”¨æˆ·ä¸»ç›®å½•ã€‚

**å»ºè®®**: ä½¿ç”¨ `dirs::home_dir()` æˆ– `shellexpand` crate å¤„ç†è·¯å¾„å±•å¼€ï¼Œæˆ–åœ¨ sync é˜¶æ®µç»Ÿä¸€è½¬æ¢ã€‚

---

#### é—®é¢˜ 3ï¼šlockfile æ—¶é—´æˆ³ä½¿ç”¨ Unix epoch ç§’æ•°

**ä½ç½®**: `src/sync/lockfile.rs:125-136`

```rust
fn chrono_now() -> String {
    let secs = duration.as_secs();
    format!("{}", secs)  // è¾“å‡º: "1734380000"
}
```

**æè¿°**: æ–‡æ¡£è¦æ±‚ ISO 8601 æ ¼å¼ (`2024-12-17T01:30:00Z`)ï¼Œå®é™…è¾“å‡ºçº¯æ•°å­—ã€‚

**å½±å“**: 
1. lockfile å¯è¯»æ€§å·®
2. ä¸æ–‡æ¡£ä¸ä¸€è‡´
3. å¯èƒ½å¯¼è‡´è·¨æ—¶åŒºé—®é¢˜

**å»ºè®®**: æ·»åŠ ç®€å•çš„ ISO 8601 æ ¼å¼åŒ–æˆ–ä½¿ç”¨ `chrono` crateã€‚

---

### 2.2 ä¸­ç­‰é—®é¢˜ (Medium)

#### é—®é¢˜ 4ï¼švalidate æ–¹æ³•æ™®éä¸ºç©ºå®ç°

**ä½ç½®**: æ‰€æœ‰é€‚é…å™¨çš„ `validate()` æ–¹æ³•

```rust
fn validate(&self, _output: &OutputFile) -> Vec<Diagnostic> {
    // TODO: Implement validation checks
    Vec::new()
}
```

**æè¿°**: é™¤ Codex å¤–ï¼Œå…¶ä»– 4 ä¸ªé€‚é…å™¨çš„ validate æ–¹æ³•å‡è¿”å›ç©ºï¼Œç¼ºå°‘æ–‡æ¡£ä¸­æè¿°çš„éªŒè¯é€»è¾‘ï¼š
- Claude Code: `permissions.deny` å­˜åœ¨æ€§
- Cursor: è§„åˆ™å†²çªæ£€æµ‹
- VS Code: é‡å  `applyTo` æ¨¡å¼æ£€æµ‹
- Antigravity: Turbo æ¨¡å¼æŒ‡ç¤ºå™¨æ£€æµ‹

**å»ºè®®**: è¡¥å……å®ç°æˆ–ç§»è‡³ Phase 5.5 è®¡åˆ’ä¸­æ˜ç¡®æ ‡è®°ã€‚

---

#### é—®é¢˜ 5ï¼š`settings.local.json` æœªå®ç°

**ä½ç½®**: `src/adapters/claude_code.rs`

**æè¿°**: spec.md 4.1 æ˜ç¡®è¦æ±‚ç”Ÿæˆä¸¤ç±» settings æ–‡ä»¶ï¼š
- `.claude/settings.json` (å›¢é˜Ÿå…±äº«) âœ…
- `.claude/settings.local.json` (æœ¬æœºè¦†ç›–) âŒ

**å½±å“**: ç”¨æˆ·æ— æ³•é…ç½®æœ¬åœ°è¦†ç›–é¡¹è€Œä¸å½±å“å›¢é˜Ÿå…±äº«é…ç½®ã€‚

---

#### é—®é¢˜ 6ï¼šAGENTS.md æœªè‡ªåŠ¨ç”Ÿæˆ

**ä½ç½®**: `src/sync/mod.rs`

**æè¿°**: `vscode.rs` æœ‰ `generate_agents_md()` å‡½æ•°ï¼Œä½† sync æµç¨‹ä¸­æœªè°ƒç”¨ã€‚

```rust
// vscode.rs æœ‰æ­¤å‡½æ•°
pub fn generate_agents_md(assets: &[PromptAsset]) -> String { ... }

// ä½† sync æµç¨‹æœªä½¿ç”¨
pub fn sync(...) { ... }
```

**å»ºè®®**: åœ¨ sync å®Œæˆåè‡ªåŠ¨ç”Ÿæˆ `AGENTS.md`ã€‚

---

#### é—®é¢˜ 7ï¼šTD-18 ç‰ˆæœ¬åŒ–é€‚é…å™¨æœªå®ç°

**ä½ç½®**: `src/adapters/mod.rs`

**æè¿°**: spec å’Œ tech-decisions.md å¼ºè°ƒé€‚é…å™¨å¿…é¡»ç‰ˆæœ¬åŒ–ä»¥åº”å¯¹ IDE å˜åŒ–ï¼š

```rust
// æœŸæœ›çš„ trait (æ¥è‡ª pitfall-mitigations.md)
pub trait TargetAdapter {
    fn min_version(&self) -> Option<SemVer>;
    fn max_tested_version(&self) -> Option<SemVer>;
    fn detect_version(&self) -> Result<SemVer, DetectionError>;
}

// å®é™…å®ç°
pub trait TargetAdapter {
    fn target(&self) -> Target;
    fn compile(&self, asset: &PromptAsset) -> CalvinResult<Vec<OutputFile>>;
    fn validate(&self, output: &OutputFile) -> Vec<Diagnostic>;
    fn security_baseline(&self) -> Vec<OutputFile>;
    fn header(&self, source_path: &str) -> String;
}
```

**å½±å“**: æ— æ³•è­¦å‘Šç”¨æˆ· IDE ç‰ˆæœ¬ä¸ adapter æµ‹è¯•ç‰ˆæœ¬ä¸å…¼å®¹ã€‚

---

#### é—®é¢˜ 8ï¼šMCP ç™½åå•æœºåˆ¶ç¼ºå¤±

**ä½ç½®**: æœªå®ç°

**æè¿°**: spec.md (4.2, 7) åå¤å¼ºè°ƒ MCP server å¿…é¡»ä½¿ç”¨ç™½åå•æœºåˆ¶ï¼š

> "ä½ çš„å·¥å…·é»˜è®¤åªå…è®¸ä»ä½ ä»¬çš„ allowlist æ¸…å•é‡Œç”Ÿæˆ MCP servers"

å½“å‰ä»£ç ä¸­ï¼š
- æ—  MCP é…ç½®ç”Ÿæˆ
- æ— ç™½åå•å®šä¹‰
- doctor ä»…æ£€æŸ¥æ–‡ä»¶å­˜åœ¨ï¼Œä¸éªŒè¯å†…å®¹

**é£é™©**: æ¶æ„ MCP server å¯èƒ½è¢«æ— å£°æ¥å—ã€‚

---

### 2.3 è½»å¾®é—®é¢˜ (Minor)

#### é—®é¢˜ 9ï¼šTODO.md ä¸­ Phase 4 çŠ¶æ€çŸ›ç›¾

**ä½ç½®**: `TODO.md:117` vs `TODO.md:254`

```markdown
## Phase 4: File Watcher âœ… COMPLETE  (ç¬¬ 117 è¡Œ)
...
| 4: Watch | ğŸ”² Not Started | ...     (ç¬¬ 254 è¡Œ)
```

**æè¿°**: åŒä¸€æ–‡ä»¶ä¸­ Phase 4 çŠ¶æ€ä¸ä¸€è‡´ã€‚

---

#### é—®é¢˜ 10ï¼šheader æ ¼å¼ä¸æ–‡æ¡£ä¸å®Œå…¨ä¸€è‡´

**ä½ç½®**: `src/adapters/mod.rs:77`

```rust
// å®é™…ç”Ÿæˆ
"<!-- Generated by Calvin. Source: {}. DO NOT EDIT. -->\n\n"

// spec.md ç¤ºä¾‹
"<!-- Generated by promptctl. Source: .promptpack/actions/code-review.md. DO NOT EDIT. -->"
```

**å·®å¼‚**: 
1. å·¥å…·å (`Calvin` vs `promptctl`) - å¯æ¥å—ï¼Œè¿™æ˜¯æœ€ç»ˆå‘½å
2. æ ¼å¼ç»†èŠ‚ä¸€è‡´ âœ…

---

#### é—®é¢˜ 11ï¼šç¼ºå°‘ `--merge` é€‰é¡¹å®ç°

**ä½ç½®**: `src/main.rs`

**æè¿°**: TODO.md æ ‡è®° `--merge` ä¸ºå¯é€‰åŠŸèƒ½ï¼Œä½† CLI ä¸­æœªå®šä¹‰å‚æ•°ã€‚è¿™ä¸ pitfall-mitigations.md P4 ä¸­æè¿°çš„ç»“æ„åŒ–åˆå¹¶èƒ½åŠ›ç›¸å…³ã€‚

---

#### é—®é¢˜ 12ï¼šé”™è¯¯ç±»å‹æœªè¦†ç›–é…ç½®é”™è¯¯

**ä½ç½®**: `src/error.rs`

**æè¿°**: æ ¹æ® TD-10ï¼Œé€€å‡ºç  3 åº”è¡¨ç¤ºé…ç½®é”™è¯¯ã€‚ä½† `CalvinError` æšä¸¾ä¸­æ— ä¸“é—¨çš„é…ç½®é”™è¯¯ç±»å‹ï¼Œconfig.rs å¤ç”¨äº† `InvalidFrontmatter`ã€‚

```rust
// config.rs:136
.map_err(|e| crate::error::CalvinError::InvalidFrontmatter { ... })
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šæµ‹è¯•è¦†ç›–ç‡åˆ†æ

| æ¨¡å— | æµ‹è¯•æ•° | è¦†ç›–æƒ…å†µ |
|-----|--------|---------|
| models.rs | 14 | æ ¸å¿ƒç»“æ„å®Œæ•´è¦†ç›– |
| parser.rs | 9 | æ­£å¸¸/å¼‚å¸¸è·¯å¾„è¦†ç›– |
| adapters/*.rs | 52+ | å„é€‚é…å™¨åŸºæœ¬è¦†ç›– |
| sync/*.rs | 7 | åŸºç¡€åŠŸèƒ½è¦†ç›– |
| security.rs | 5 | doctor åŸºç¡€è¦†ç›– |
| config.rs | 8 | é…ç½®è§£æè¦†ç›– |
| escaping.rs | 14 | è½¬ä¹‰å‡½æ•°å®Œæ•´è¦†ç›– |

**ç¼ºå¤±æµ‹è¯•**:
1. æ—  snapshot æµ‹è¯• (TD-9 è¦æ±‚)
2. æ—  golden æµ‹è¯• (æ•´ä½“æµç¨‹ç«¯åˆ°ç«¯)
3. æ—  fuzzing/è¾¹ç•Œæµ‹è¯•
4. æ— é›†æˆæµ‹è¯• (çœŸå® .promptpack ç›®å½•)

---

## ç¬¬å››éƒ¨åˆ†ï¼šæ€»ç»“ä¸å»ºè®®

### ç»¼åˆè¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|-----|------|-----|
| æ–‡æ¡£å¯¹é½åº¦ | 7/10 | æ ¸å¿ƒåŠŸèƒ½å¯¹é½ï¼Œéƒ¨åˆ†é«˜çº§ç‰¹æ€§å»¶å |
| ä»£ç è´¨é‡ | 8/10 | ç»“æ„æ¸…æ™°ï¼ŒTDD é©±åŠ¨ |
| å®‰å…¨æ€§ | 6/10 | æœ‰åŸºç¡€é˜²æŠ¤ï¼Œç¼ºè·¯å¾„éªŒè¯å’Œ MCP ç™½åå• |
| å¯ç»´æŠ¤æ€§ | 8/10 | æ¨¡å—åŒ–å¥½ï¼Œæ–‡æ¡£æ³¨é‡Šå……åˆ† |
| æµ‹è¯•è¦†ç›– | 7/10 | å•å…ƒæµ‹è¯•å……åˆ†ï¼Œç¼ºç«¯åˆ°ç«¯æµ‹è¯• |

### ä¼˜å…ˆçº§å»ºè®®

**P0 - å‘å¸ƒå‰å¿…é¡»ä¿®å¤**:
1. æ·»åŠ è·¯å¾„å®‰å…¨è¾¹ç•Œæ£€æŸ¥ (é—®é¢˜ 1)
2. ä¿®å¤ Codex çš„ `~` è·¯å¾„å±•å¼€é—®é¢˜ (é—®é¢˜ 2)
3. ä¿®å¤ lockfile æ—¶é—´æˆ³æ ¼å¼ (é—®é¢˜ 3)

**P1 - çŸ­æœŸè¡¥å……**:
4. å®ç° `settings.local.json` ç”Ÿæˆ (é—®é¢˜ 5)
5. é›†æˆ `AGENTS.md` è‡ªåŠ¨ç”Ÿæˆ (é—®é¢˜ 6)
6. å®ç° MCP ç™½åå•åŸºç¡€æ¡†æ¶ (é—®é¢˜ 8)

**P2 - ä¸­æœŸå®Œå–„**:
7. è¡¥å…… validate æ–¹æ³•å®ç° (é—®é¢˜ 4)
8. æ·»åŠ  TD-18 ç‰ˆæœ¬åŒ–é€‚é…å™¨åŸºç¡€æ¥å£ (é—®é¢˜ 7)
9. æ·»åŠ ç«¯åˆ°ç«¯ golden æµ‹è¯•

**P3 - é•¿æœŸä¼˜åŒ–**:
10. é…ç½® release profile ä¼˜åŒ–äºŒè¿›åˆ¶å¤§å° (TD-17)
11. æ·»åŠ  `--merge` ç»“æ„åŒ–åˆå¹¶æ”¯æŒ

---

## é™„å½•ï¼šæ–‡ä»¶æ¸…å•

æœ¬æ¬¡å®¡æŸ¥æ¶‰åŠçš„ä¸»è¦æ–‡ä»¶ï¼š

```
src/
â”œâ”€â”€ adapters/
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ claude_code.rs
â”‚   â”œâ”€â”€ cursor.rs
â”‚   â”œâ”€â”€ vscode.rs
â”‚   â”œâ”€â”€ antigravity.rs
â”‚   â”œâ”€â”€ codex.rs
â”‚   â””â”€â”€ escaping.rs
â”œâ”€â”€ sync/
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ lockfile.rs
â”‚   â””â”€â”€ writer.rs
â”œâ”€â”€ config.rs
â”œâ”€â”€ error.rs
â”œâ”€â”€ lib.rs
â”œâ”€â”€ main.rs
â”œâ”€â”€ models.rs
â”œâ”€â”€ parser.rs
â””â”€â”€ security.rs

docs/
â”œâ”€â”€ pitfall-mitigations.md
â”œâ”€â”€ target-platforms.md
â”œâ”€â”€ tech-decisions.md
â””â”€â”€ configuration.md

spec.md
TODO.md
```

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-12-17T02:35:00+08:00*
